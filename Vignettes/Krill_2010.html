<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Krill</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Krill</h1>



<div id="krill-assessment" class="section level2">
<h2>Krill Assessment</h2>
<p>This document aims to reproduce the Krill assessment process undertaken for WGEMM2010.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(Grym)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(furrr)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">set.seed</span>(<span class="dv">31</span>)</a></code></pre></div>
</div>
<div id="recruitment-model" class="section level2">
<h2>Recruitment model</h2>
<p>Grym offers several variants of the proportional recruitment model with mutually interfaces - select the analog of the model used in the GYM</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">## Select recruitment model</span></a>
<a class="sourceLine" id="cb2-2" title="2">prRecruitPars &lt;-<span class="st"> </span>prRecruitParsGYM</a>
<a class="sourceLine" id="cb2-3" title="3">prRecruitsQuantile &lt;-<span class="st"> </span>prRecruitsQuantileGYM</a>
<a class="sourceLine" id="cb2-4" title="4">prRecruits &lt;-<span class="st"> </span>prRecruitsGYM</a></code></pre></div>
</div>
<div id="survey-data" class="section level2">
<h2>Survey data</h2>
<p>The primary inut data is the mean and variance of the estimated proportion of a “recruitment” age class estimated from independent surveys to determine the properties of the recruitment model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">R.mean &lt;-<span class="st"> </span><span class="fl">0.557</span></a>
<a class="sourceLine" id="cb3-2" title="2">R.var &lt;-<span class="st"> </span><span class="fl">0.1</span><span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb3-3" title="3">R.class &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb3-4" title="4">R.nsurveys &lt;-<span class="st"> </span><span class="dv">17</span></a></code></pre></div>
</div>
<div id="model" class="section level2">
<h2>Model</h2>
<p>The <code>KrillProjection</code> function returns a function that generates a single set of random projections that differ only in gamma. The projections within each set use a common random selectivity and maturity curves, virign biomass and recruitment series, so within a set the projections only differ by the level of fishing applied. The resulting function takes a single numerical argument that is used to identify the set.</p>
<p>The arguments are</p>
<ul>
<li><code>R.mean</code>, <code>R.var</code> - the estimated mean and variance of the number of individuals in the reference age class as a proportion of all individuals of that age or older</li>
<li><code>R.class</code> - the reference age class.</li>
<li><code>R.nsurveys</code> - the number of surveys used to estimate <code>R.mean</code> and <code>R.var</code>.</li>
<li><code>gamma</code> - the gamma ratios to test</li>
<li><code>n.years</code> - the number of years to project ahead.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">KrillProjection &lt;-<span class="st"> </span><span class="cf">function</span>(R.mean,R.var,R.class,R.nsurveys,</a>
<a class="sourceLine" id="cb4-2" title="2">                       <span class="dt">gamma=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.04</span>,<span class="fl">0.08</span>,<span class="fl">0.1</span>),<span class="dt">n.years=</span><span class="dv">20</span>) {</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="co">## Daily time steps with 8 age classes</span></a>
<a class="sourceLine" id="cb4-5" title="5">  nsteps &lt;-<span class="st"> </span><span class="dv">365</span></a>
<a class="sourceLine" id="cb4-6" title="6">  Ages &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">7</span></a>
<a class="sourceLine" id="cb4-7" title="7">  Days &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length=</span>nsteps<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-8" title="8">  h &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>nsteps</a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="co">## Spawning and monitoring interval</span></a>
<a class="sourceLine" id="cb4-11" title="11">  spawnI &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">90</span></a>
<a class="sourceLine" id="cb4-12" title="12">  monitorI &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">61</span></a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14">  <span class="co">## Ages, length at age and weight at age</span></a>
<a class="sourceLine" id="cb4-15" title="15">  ages &lt;-<span class="st"> </span><span class="kw">outer</span>(Days,Ages,<span class="dt">FUN=</span><span class="st">&quot;+&quot;</span>)</a>
<a class="sourceLine" id="cb4-16" title="16">  ls &lt;-<span class="st"> </span><span class="kw">vonBertalanffyRAL</span>(ages,<span class="dt">t0=</span><span class="fl">0.0</span>,<span class="dt">K=</span><span class="fl">0.45</span>,<span class="dt">Linf=</span><span class="fl">60.8</span>,<span class="dt">f0=</span><span class="dv">0</span>,<span class="dt">f1=</span><span class="dv">91</span><span class="op">/</span><span class="dv">365</span>)</a>
<a class="sourceLine" id="cb4-17" title="17">  ws &lt;-<span class="st"> </span><span class="kw">powerLW</span>(ls,<span class="dv">1</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19">  <span class="co">## Constant intra-annual natural mortality</span></a>
<a class="sourceLine" id="cb4-20" title="20">  ms &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>,nsteps<span class="op">+</span><span class="dv">1</span>,<span class="kw">length</span>(Ages))</a>
<a class="sourceLine" id="cb4-21" title="21">  Ms &lt;-<span class="st"> </span><span class="kw">ctrapz</span>(ms,h)</a>
<a class="sourceLine" id="cb4-22" title="22">  Msf &lt;-<span class="st"> </span><span class="kw">final</span>(Ms)</a>
<a class="sourceLine" id="cb4-23" title="23"></a>
<a class="sourceLine" id="cb4-24" title="24">  <span class="co">## Within year fishing pattern - season is first 90 days</span></a>
<a class="sourceLine" id="cb4-25" title="25">  fwy &lt;-<span class="st"> </span><span class="kw">double</span>(nsteps<span class="op">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-26" title="26">  fwy[<span class="dv">1</span><span class="op">:</span><span class="dv">90</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-27" title="27">  fwy &lt;-<span class="st"> </span>fwy<span class="op">/</span><span class="kw">mean</span>(fwy)</a>
<a class="sourceLine" id="cb4-28" title="28"></a>
<a class="sourceLine" id="cb4-29" title="29">  <span class="co">## Recruitment survey - parameters for the observed ratios</span></a>
<a class="sourceLine" id="cb4-30" title="30">  ps0 &lt;-<span class="st"> </span><span class="kw">prRecruitPars</span>(Msf,R.mean,R.var,<span class="dt">r=</span>R.class)</a>
<a class="sourceLine" id="cb4-31" title="31"></a>
<a class="sourceLine" id="cb4-32" title="32">  B0logsd &lt;-<span class="st"> </span><span class="fl">0.2</span></a>
<a class="sourceLine" id="cb4-33" title="33">  </a>
<a class="sourceLine" id="cb4-34" title="34">  <span class="co">## This function performs the a projection for each prescibed gamma.</span></a>
<a class="sourceLine" id="cb4-35" title="35">  <span class="cf">function</span>(run) {</a>
<a class="sourceLine" id="cb4-36" title="36"></a>
<a class="sourceLine" id="cb4-37" title="37">    <span class="co">## Length based maturity and selectivity - ramp width is constant</span></a>
<a class="sourceLine" id="cb4-38" title="38">    <span class="co">## but the midpoint is selected uniformly from a range.</span></a>
<a class="sourceLine" id="cb4-39" title="39">    gs &lt;-<span class="st"> </span><span class="kw">rampOgive</span>(ls,<span class="kw">runif</span>(<span class="dv">1</span>,<span class="dv">32</span>,<span class="dv">37</span>),<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb4-40" title="40">    ss &lt;-<span class="st"> </span><span class="kw">rampOgive</span>(ls,<span class="kw">runif</span>(<span class="dv">1</span>,<span class="dv">30</span>,<span class="dv">39</span>),<span class="dv">9</span>)</a>
<a class="sourceLine" id="cb4-41" title="41"></a>
<a class="sourceLine" id="cb4-42" title="42">    <span class="co">## Construct fishing mortalities from season and selectivity</span></a>
<a class="sourceLine" id="cb4-43" title="43">    fs &lt;-<span class="st"> </span>fwy<span class="op">*</span>ss</a>
<a class="sourceLine" id="cb4-44" title="44">    Fs &lt;-<span class="st"> </span><span class="kw">ctrapz</span>(fs,h)</a>
<a class="sourceLine" id="cb4-45" title="45">    Fsf &lt;-<span class="st"> </span><span class="kw">final</span>(Fs)</a>
<a class="sourceLine" id="cb4-46" title="46"></a>
<a class="sourceLine" id="cb4-47" title="47">    <span class="co">## Boostrap resample to account for uncertainty in R.mean and R.var</span></a>
<a class="sourceLine" id="cb4-48" title="48">    <span class="cf">repeat</span> {</a>
<a class="sourceLine" id="cb4-49" title="49">      Rbt &lt;-<span class="st"> </span><span class="kw">prBootstrap</span>(prRecruits,ps0,R.nsurveys,Msf,<span class="dt">r=</span>R.class)</a>
<a class="sourceLine" id="cb4-50" title="50">      ps &lt;-<span class="st"> </span><span class="kw">tryCatch</span>(<span class="kw">prRecruitPars</span>(Msf,R.mean,R.var,<span class="dt">r=</span>R.class),<span class="dt">error=</span><span class="cf">function</span>(e) e)</a>
<a class="sourceLine" id="cb4-51" title="51">      <span class="cf">if</span>(<span class="op">!</span><span class="kw">inherits</span>(ps,<span class="st">&quot;error&quot;</span>)) <span class="cf">break</span></a>
<a class="sourceLine" id="cb4-52" title="52">    }</a>
<a class="sourceLine" id="cb4-53" title="53"></a>
<a class="sourceLine" id="cb4-54" title="54">    <span class="co">## Natural mortalities from proprtional recruitment model</span></a>
<a class="sourceLine" id="cb4-55" title="55">    M &lt;-<span class="st"> </span>ps<span class="op">$</span>M</a>
<a class="sourceLine" id="cb4-56" title="56">    MMs &lt;-<span class="st"> </span>M<span class="op">*</span>Ms</a>
<a class="sourceLine" id="cb4-57" title="57"></a>
<a class="sourceLine" id="cb4-58" title="58">    <span class="co">## Median spawning biomass estimated from 1000 samples</span></a>
<a class="sourceLine" id="cb4-59" title="59">    R &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">prRecruits</span>(<span class="dv">1000</span><span class="op">*</span><span class="kw">length</span>(Msf),ps),<span class="dv">1000</span>,<span class="kw">length</span>(Msf))</a>
<a class="sourceLine" id="cb4-60" title="60">    ssb0 &lt;-<span class="st"> </span><span class="kw">spawningB0S</span>(R,gs,ws,Ms,M,<span class="dt">spawn=</span>spawnI)<span class="op">$</span>median</a>
<a class="sourceLine" id="cb4-61" title="61"></a>
<a class="sourceLine" id="cb4-62" title="62">    <span class="co">## Stochastic initial age structure in the absence of fishing</span></a>
<a class="sourceLine" id="cb4-63" title="63">    N0 &lt;-<span class="st"> </span><span class="kw">ageStructureS</span>(<span class="kw">prRecruits</span>(<span class="kw">length</span>(Msf),ps),Msf,M)</a>
<a class="sourceLine" id="cb4-64" title="64"></a>
<a class="sourceLine" id="cb4-65" title="65">    <span class="co">## Recruitment series</span></a>
<a class="sourceLine" id="cb4-66" title="66">    Rs &lt;-<span class="st"> </span><span class="kw">prRecruits</span>(n.years,ps)</a>
<a class="sourceLine" id="cb4-67" title="67"></a>
<a class="sourceLine" id="cb4-68" title="68">    <span class="co">## Matrix of annual summaries</span></a>
<a class="sourceLine" id="cb4-69" title="69">    n &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">+</span>n.years)<span class="op">*</span><span class="kw">length</span>(gamma)</a>
<a class="sourceLine" id="cb4-70" title="70">    df &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,n,<span class="dv">11</span>)</a>
<a class="sourceLine" id="cb4-71" title="71">    <span class="kw">colnames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>,<span class="st">&quot;Gamma&quot;</span>,<span class="st">&quot;R&quot;</span>,<span class="st">&quot;N&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;B0&quot;</span>,<span class="st">&quot;SSN&quot;</span>,<span class="st">&quot;SSB&quot;</span>,<span class="st">&quot;SSB0&quot;</span>,<span class="st">&quot;Catch&quot;</span>,<span class="st">&quot;F&quot;</span>)</a>
<a class="sourceLine" id="cb4-72" title="72"></a>
<a class="sourceLine" id="cb4-73" title="73">    <span class="co">## Initial projection assuming no fishing</span></a>
<a class="sourceLine" id="cb4-74" title="74">    pr0 &lt;-<span class="st"> </span><span class="kw">project</span>(ws,MMs,<span class="dt">Nref=</span>N0,<span class="dt">yield=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-75" title="75">    pr0<span class="op">$</span>F &lt;-<span class="st"> </span>pr0<span class="op">$</span>Y &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb4-76" title="76"></a>
<a class="sourceLine" id="cb4-77" title="77">    <span class="co">## Initial biomass in monitoring period + log Normal error</span></a>
<a class="sourceLine" id="cb4-78" title="78">    b0 &lt;-<span class="st"> </span><span class="kw">meanStock</span>(pr0<span class="op">$</span>B,<span class="dt">period=</span>monitorI)</a>
<a class="sourceLine" id="cb4-79" title="79">    b0 &lt;-<span class="st"> </span><span class="kw">rlnorm</span>(<span class="dv">1</span>,<span class="kw">log</span>(b0)<span class="op">-</span>B0logsd<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="dv">2</span>,B0logsd)</a>
<a class="sourceLine" id="cb4-80" title="80">    </a>
<a class="sourceLine" id="cb4-81" title="81">    k &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb4-82" title="82">    <span class="co">## Project for each gamma ratio</span></a>
<a class="sourceLine" id="cb4-83" title="83">    <span class="cf">for</span>(g <span class="cf">in</span> gamma) {</a>
<a class="sourceLine" id="cb4-84" title="84">      <span class="co">## Target catch</span></a>
<a class="sourceLine" id="cb4-85" title="85">      catch &lt;-<span class="st"> </span>g<span class="op">*</span>b0</a>
<a class="sourceLine" id="cb4-86" title="86"></a>
<a class="sourceLine" id="cb4-87" title="87">      <span class="co">## Reset to virgin state</span></a>
<a class="sourceLine" id="cb4-88" title="88">      pr &lt;-<span class="st"> </span>pr0</a>
<a class="sourceLine" id="cb4-89" title="89">      ssb &lt;-<span class="st"> </span><span class="kw">spawningStock</span>(pr<span class="op">$</span>B,gs,spawnI)</a>
<a class="sourceLine" id="cb4-90" title="90">      </a>
<a class="sourceLine" id="cb4-91" title="91">      <span class="cf">for</span>(yr <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span>n.years) {</a>
<a class="sourceLine" id="cb4-92" title="92"></a>
<a class="sourceLine" id="cb4-93" title="93">        <span class="cf">if</span>(yr <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb4-94" title="94">          <span class="co">## Recruitment depletion</span></a>
<a class="sourceLine" id="cb4-95" title="95">          r &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="dv">1</span>,ssb<span class="op">/</span>(<span class="fl">0.2</span><span class="op">*</span>ssb0))</a>
<a class="sourceLine" id="cb4-96" title="96">          <span class="co">## Project over year</span></a>
<a class="sourceLine" id="cb4-97" title="97">          N0 &lt;-<span class="st"> </span><span class="kw">advance</span>(pr<span class="op">$</span>N,r<span class="op">*</span>Rs[yr])</a>
<a class="sourceLine" id="cb4-98" title="98">          pr &lt;-<span class="st"> </span><span class="kw">projectC</span>(ws,MMs,Fs,fs,catch,<span class="dt">Nref=</span>N0,<span class="dt">yield=</span><span class="dv">1</span>,<span class="dt">Fmax=</span><span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb4-99" title="99">          <span class="co">#if(pr$F==1.5) return(NULL)</span></a>
<a class="sourceLine" id="cb4-100" title="100">        }</a>
<a class="sourceLine" id="cb4-101" title="101">        ssb &lt;-<span class="st"> </span><span class="kw">spawningStock</span>(pr<span class="op">$</span>B,gs,spawnI)</a>
<a class="sourceLine" id="cb4-102" title="102">        </a>
<a class="sourceLine" id="cb4-103" title="103">        <span class="co">## Collate annual summaries</span></a>
<a class="sourceLine" id="cb4-104" title="104">        df[k&lt;-k<span class="op">+</span><span class="dv">1</span>,] &lt;-<span class="st"> </span><span class="kw">c</span>(yr,g,<span class="kw">initial</span>(pr<span class="op">$</span>N)[<span class="dv">1</span>],<span class="kw">sum</span>(<span class="kw">initial</span>(pr<span class="op">$</span>N)),<span class="kw">sum</span>(<span class="kw">initial</span>(pr<span class="op">$</span>B)),b0,</a>
<a class="sourceLine" id="cb4-105" title="105">                         <span class="kw">spawningStock</span>(pr<span class="op">$</span>N,gs,spawnI),ssb,ssb0,<span class="kw">sum</span>(pr<span class="op">$</span>Y),pr<span class="op">$</span>F)</a>
<a class="sourceLine" id="cb4-106" title="106"></a>
<a class="sourceLine" id="cb4-107" title="107">      }</a>
<a class="sourceLine" id="cb4-108" title="108">    }</a>
<a class="sourceLine" id="cb4-109" title="109">    <span class="kw">data.frame</span>(<span class="dt">Run=</span>run,<span class="dt">M=</span>M,df)</a>
<a class="sourceLine" id="cb4-110" title="110">  }</a>
<a class="sourceLine" id="cb4-111" title="111">}</a></code></pre></div>
</div>
<div id="projection" class="section level2">
<h2>Projection</h2>
<p>Calling <code>KrillProjection</code> returns a function that generates a single “run” of the simulation</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">sim &lt;-<span class="st"> </span><span class="kw">KrillProjection</span>(R.mean,R.var,R.class,R.nsurveys) </a></code></pre></div>
<p>The function takes a single argument that is used to label the results. Within a single call to <code>sim</code>, a common set of random maturity, selectivity, initial ages and recruitment series are used to make projections for each requested gamma.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">df &lt;-<span class="st"> </span><span class="kw">sim</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">head</span>(df)</a>
<a class="sourceLine" id="cb6-3" title="3">  Run         M Year Gamma         R        N        B      B0       SSN</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="dv">1</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>    <span class="dv">0</span>     <span class="dv">0</span> <span class="fl">0.8536061</span> <span class="fl">1.514582</span> <span class="fl">31153.97</span> <span class="fl">40875.9</span> <span class="fl">0.3999736</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="dv">2</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>    <span class="dv">1</span>     <span class="dv">0</span> <span class="fl">0.5465188</span> <span class="fl">1.206322</span> <span class="fl">28457.95</span> <span class="fl">40875.9</span> <span class="fl">0.2978799</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="dv">3</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>    <span class="dv">2</span>     <span class="dv">0</span> <span class="fl">1.0481601</span> <span class="fl">1.572577</span> <span class="fl">25176.15</span> <span class="fl">40875.9</span> <span class="fl">0.2813316</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="dv">4</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>    <span class="dv">3</span>     <span class="dv">0</span> <span class="fl">1.8192387</span> <span class="fl">2.504645</span> <span class="fl">24192.90</span> <span class="fl">40875.9</span> <span class="fl">0.2532434</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="dv">5</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>    <span class="dv">4</span>     <span class="dv">0</span> <span class="fl">0.6525026</span> <span class="fl">1.746148</span> <span class="fl">29967.54</span> <span class="fl">40875.9</span> <span class="fl">0.3522842</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="dv">6</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>    <span class="dv">5</span>     <span class="dv">0</span> <span class="fl">1.0075046</span> <span class="fl">1.769682</span> <span class="fl">33817.08</span> <span class="fl">40875.9</span> <span class="fl">0.4563235</span></a>
<a class="sourceLine" id="cb6-10" title="10">       SSB     SSB0 Catch F</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="dv">1</span> <span class="fl">34017.69</span> <span class="fl">30191.68</span>     <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="dv">2</span> <span class="fl">28552.73</span> <span class="fl">30191.68</span>     <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="dv">3</span> <span class="fl">26242.87</span> <span class="fl">30191.68</span>     <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="dv">4</span> <span class="fl">23189.41</span> <span class="fl">30191.68</span>     <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="dv">5</span> <span class="fl">27959.27</span> <span class="fl">30191.68</span>     <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="dv">6</span> <span class="fl">37397.51</span> <span class="fl">30191.68</span>     <span class="dv">0</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="kw">tail</span>(df)</a>
<a class="sourceLine" id="cb6-18" title="18">   Run         M Year Gamma         R        N        B      B0       SSN</a>
<a class="sourceLine" id="cb6-19" title="19"><span class="dv">79</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>   <span class="dv">15</span>   <span class="fl">0.1</span> <span class="fl">1.3269317</span> <span class="fl">2.096988</span> <span class="fl">26786.87</span> <span class="fl">40875.9</span> <span class="fl">0.3411170</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="dv">80</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>   <span class="dv">16</span>   <span class="fl">0.1</span> <span class="fl">1.1263923</span> <span class="fl">2.019755</span> <span class="fl">28543.38</span> <span class="fl">40875.9</span> <span class="fl">0.3243421</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="dv">81</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>   <span class="dv">17</span>   <span class="fl">0.1</span> <span class="fl">1.4324237</span> <span class="fl">2.293817</span> <span class="fl">30126.21</span> <span class="fl">40875.9</span> <span class="fl">0.3638509</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="dv">82</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>   <span class="dv">18</span>   <span class="fl">0.1</span> <span class="fl">1.1076294</span> <span class="fl">2.088097</span> <span class="fl">31885.75</span> <span class="fl">40875.9</span> <span class="fl">0.3660001</span></a>
<a class="sourceLine" id="cb6-23" title="23"><span class="dv">83</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>   <span class="dv">19</span>   <span class="fl">0.1</span> <span class="fl">0.9341021</span> <span class="fl">1.825202</span> <span class="fl">32906.96</span> <span class="fl">40875.9</span> <span class="fl">0.3970426</span></a>
<a class="sourceLine" id="cb6-24" title="24"><span class="dv">84</span>   <span class="dv">1</span> <span class="fl">0.8279458</span>   <span class="dv">20</span>   <span class="fl">0.1</span> <span class="fl">0.4810081</span> <span class="fl">1.256636</span> <span class="fl">31245.20</span> <span class="fl">40875.9</span> <span class="fl">0.3545237</span></a>
<a class="sourceLine" id="cb6-25" title="25">        SSB     SSB0    Catch         F</a>
<a class="sourceLine" id="cb6-26" title="26"><span class="dv">79</span> <span class="fl">26373.17</span> <span class="fl">30191.68</span> <span class="fl">4087.586</span> <span class="fl">0.1921956</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="dv">80</span> <span class="fl">26243.87</span> <span class="fl">30191.68</span> <span class="fl">4087.587</span> <span class="fl">0.1901218</span></a>
<a class="sourceLine" id="cb6-28" title="28"><span class="dv">81</span> <span class="fl">29136.22</span> <span class="fl">30191.68</span> <span class="fl">4087.594</span> <span class="fl">0.1722237</span></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="dv">82</span> <span class="fl">29714.63</span> <span class="fl">30191.68</span> <span class="fl">4087.594</span> <span class="fl">0.1680409</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="dv">83</span> <span class="fl">32335.22</span> <span class="fl">30191.68</span> <span class="fl">4087.592</span> <span class="fl">0.1532570</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="dv">84</span> <span class="fl">30452.00</span> <span class="fl">30191.68</span> <span class="fl">4087.593</span> <span class="fl">0.1576512</span></a></code></pre></div>
<p>For these parameters, the recruitment variability has greater impact than increased fishing pressure</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">ggplot</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Gamma=</span><span class="kw">factor</span>(Gamma)),<span class="kw">aes</span>(<span class="dt">x=</span>Year,<span class="dt">y=</span>N,<span class="dt">colour=</span>Gamma))<span class="op">+</span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Generate 1000 runs and bind them into one large dataframe. The runs are performed in parallel with the <code>furrr</code> library</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">plan</span>(multiprocess)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">system.time</span>(df &lt;-<span class="st"> </span><span class="kw">future_map_dfr</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>,sim))</a>
<a class="sourceLine" id="cb8-3" title="3">   user  system elapsed </a>
<a class="sourceLine" id="cb8-4" title="4">   <span class="fl">0.27</span>    <span class="fl">0.10</span>   <span class="fl">37.50</span> </a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Gamma,Run) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">Dep=</span><span class="kw">min</span>(SSB<span class="op">/</span>SSB0)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">Pr=</span><span class="kw">mean</span>(Dep <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co"># A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb9-3" title="3">  Gamma    Pr</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="op">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="dv">1</span>  <span class="dv">0</span>    <span class="dv">0</span>    </a>
<a class="sourceLine" id="cb9-6" title="6"><span class="dv">2</span>  <span class="fl">0.04</span> <span class="dv">0</span>    </a>
<a class="sourceLine" id="cb9-7" title="7"><span class="dv">3</span>  <span class="fl">0.08</span> <span class="dv">0</span>    </a>
<a class="sourceLine" id="cb9-8" title="8"><span class="dv">4</span>  <span class="fl">0.1</span>  <span class="fl">0.001</span></a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
